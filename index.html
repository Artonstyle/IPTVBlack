<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Black IPTV 2026 – Samsung Tizen</title>

  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <script type="text/javascript" src="$WEBAPIS/webapis/webapis.js"></script>

  <style>
    :root{
      --blue:#0045ff;
      --cyan:#00d2ff;
      --glass:rgba(0,40,120,.22);
      --glass2:rgba(0,0,0,.26);
      --muted:rgba(255,255,255,.65);
      --muted2:rgba(255,255,255,.40);
      --danger:#ff4d4d;
      --gold:#ffcc00;
    }
    *{box-sizing:border-box; outline:none}
    body{
      width:1920px;height:1080px;margin:0;
      background: radial-gradient(circle at top right, #001a4d, #00050a);
      background-size:cover;background-position:center;
      color:#fff;font-family: Arial, sans-serif; overflow:hidden;
    }

    header{
      height:160px;
      display:flex; justify-content:space-between; align-items:center;
      padding:0 80px;
      border-bottom:2px solid rgba(0,210,255,.15);
    }
    .brand{font-size:52px; font-weight:900; letter-spacing:-1px}
    .brand span{color:var(--cyan); font-style:italic}
    #menu{display:flex; gap:18px}
    .menu-item{
      padding:18px 46px;
      font-size:34px;
      font-weight:900;
      color:rgba(255,255,255,.35);
      border-radius:16px;
      transition:.12s;
    }
    .menu-item.focused{
      background:var(--blue);
      color:#fff;
      box-shadow:0 0 30px rgba(0,69,255,.6);
      transform:scale(1.04);
    }

    main{height:920px; padding:40px 60px}

    .panel{
      height:100%;
      border-radius:32px;
      background: var(--glass);
      border:1px solid rgba(0,210,255,.18);
      overflow:hidden;
      display:flex;
      flex-direction:column;
    }

    #tv-view, #vod-view, #setup-view { height:100%; display:none; }

    .tv-root{ height:100%; display:flex; gap:24px; padding:22px; }
    .col{
      background: rgba(0,0,0,.22);
      border:1px solid rgba(0,210,255,.14);
      border-radius:26px;
      overflow:hidden;
      display:flex;
      flex-direction:column;
    }
    .col-h{
      padding:18px 20px;
      color:var(--cyan);
      font-weight:900;
      letter-spacing:3px;
      font-size:14px;
      text-transform:uppercase;
      border-bottom:1px solid rgba(0,210,255,.10);
      display:flex; align-items:center; justify-content:space-between;
      gap:12px;
    }
    .list{ flex:1; overflow-y:auto; padding:14px; }
    .list::-webkit-scrollbar{ width:0; }
    .entry{
      border-radius:16px;
      border:1px solid rgba(0,210,255,.12);
      background: rgba(0,0,0,.24);
      padding:16px 16px;
      margin-bottom:12px;
      transition:.12s;
      color:rgba(255,255,255,.82);
      font-weight:900;
      font-size:26px;
      display:flex; align-items:center; gap:12px;
    }
    .entry.focused{
      border-color: rgba(0,210,255,.85);
      box-shadow:0 0 18px rgba(0,210,255,.12);
      transform: scale(1.02);
      background: rgba(0,69,255,.18);
      color:#fff;
    }
    .chan-num{ color:var(--cyan); font-weight:900; font-size:18px; min-width:42px; opacity:.85; }
    .star{ margin-left:auto; font-size:26px; color:transparent; -webkit-text-stroke:2px var(--gold); }
    .is-fav .star{ color:var(--gold); -webkit-text-stroke:0px transparent; }

    .player{ flex:1.2; display:flex; flex-direction:column; gap:14px; padding:14px; }
    .video-box{
      background:#000;
      border:2px solid rgba(0,210,255,.22);
      border-radius:26px;
      overflow:hidden;
      position:relative;
      aspect-ratio:16/9;
      max-height:520px;
    }
    video{width:100%;height:100%;object-fit:contain}
    .pinfo{ padding:14px 14px 8px 14px; display:flex; flex-direction:column; gap:8px; }
    .pname{ font-size:44px; font-weight:900; }
    .phint{ color:rgba(255,255,255,.55); font-size:18px; font-weight:800; }

    body.is-fullscreen header, body.is-fullscreen main { display:none!important; }
    body.is-fullscreen .video-box{
      position:fixed; left:0; top:0; width:1920px; height:1080px; z-index:9999; border:none; border-radius:0;
    }

    .vod-root{ height:100%; display:flex; flex-direction:column; gap:14px; padding:18px 22px; }
    .vod-topbar{
      background: rgba(0,0,0,.22); border:1px solid rgba(0,210,255,.14); border-radius:22px;
      padding:14px 18px; display:flex; align-items:center; justify-content:space-between; gap:14px;
    }
    .vod-title{ font-size:30px; font-weight:900; }
    .vod-rows{ flex:1; overflow-y:auto; padding-right:6px; }
    .vod-rows::-webkit-scrollbar{ width:0; }
    .row{ margin:14px 0 18px 0; }
    .row-h{ font-size:24px; font-weight:900; color:var(--cyan); margin:0 0 10px 8px; text-transform:uppercase; }
    .strip{ position:relative; overflow:hidden; border-radius:18px; padding:10px; background: rgba(0,0,0,.18); border:1px solid rgba(0,210,255,.10); }
    .strip-inner{ display:flex; gap:14px; transition: transform .15s ease-out; }
    .card{ width:260px; height:150px; border-radius:16px; overflow:hidden; position:relative; background: rgba(0,0,0,.35); border:1px solid rgba(0,210,255,.12); flex:0 0 auto; transition:.12s; }
    .card img{ width:100%; height:100%; object-fit:cover; display:block; }
    .card .cap{ position:absolute; left:0; right:0; bottom:0; padding:10px; font-size:14px; font-weight:900; background: linear-gradient(to top, rgba(0,0,0,.92), rgba(0,0,0,0)); white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .card.focused{ border-color: rgba(0,210,255,.85); transform: scale(1.10); z-index:2; }
    .vod-player-wrap{ display:flex; gap:18px; margin-top:8px; align-items:stretch; }
    .vod-player{ flex:1; background:#000; border:2px solid rgba(0,210,255,.22); border-radius:22px; overflow:hidden; height:320px; }
    .vod-info{ width:520px; background: rgba(0,0,0,.22); border:1px solid rgba(0,210,255,.14); border-radius:22px; padding:16px; }
    .vod-info .big{ margin-top:10px; font-weight:900; font-size:28px; }

    #setup-view{ display:flex; flex-direction:column; gap:22px; padding:22px; }
    .tabs{ display:flex; gap:14px; padding:10px; border-radius:22px; background: rgba(0,0,0,.25); border:1px solid rgba(0,210,255,.16); }
    .tab{ padding:14px 24px; font-size:22px; font-weight:900; color:rgba(255,255,255,.45); border-radius:16px; transition:.12s; background: rgba(0,0,0,.15); border:1px solid rgba(0,210,255,.10); }
    .tab.focused{ background: var(--blue); color:#fff; }
    .content-col{ flex:1; background: var(--glass2); border:1px solid rgba(0,210,255,.14); border-radius:26px; overflow:hidden; display:flex; flex-direction:column; }
    .content-header{ padding:18px 20px; color:var(--cyan); font-weight:900; border-bottom:1px solid rgba(0,210,255,.10); display:flex; justify-content:space-between; }
    .content-body{ flex:1; overflow-y:auto; padding:16px; }
    .card2{ border-radius:18px; border:1px solid rgba(0,210,255,.14); background: rgba(0,0,0,.22); padding:16px; margin-bottom:14px; }
    .card2.focused{ border-color: rgba(0,210,255,.70); background: rgba(0,69,255,.18); }
    .input{ width:100%; padding:18px; margin-top:10px; border-radius:14px; border:1px solid rgba(0,210,255,.22); background: rgba(0,0,0,.28); color:#fff; font-size:24px; }
    .btn{ flex:1; padding:16px; text-align:center; border-radius:14px; background: rgba(0,69,255,.20); font-weight:900; }
    .btn.focused{ background: var(--blue); }
    .tile-wrap{ display:flex; flex-wrap:wrap; gap:14px; }
    .tile{ flex: 0 0 calc((100% - 14px*4) / 5); border-radius:18px; border:1px solid rgba(0,210,255,.14); position:relative; overflow:hidden; }
    .tile::before{ content:""; display:block; padding-top:56.25%; }
    .tile.focused{ border-color: rgba(0,210,255,.85); transform: scale(1.05); }
    .tile img{ position:absolute; top:0; width:100%; height:100%; object-fit:cover; }
  </style>
</head>

<body onload="init()">
  <header>
    <div class="brand">BLACK<span>IPTV</span></div>
    <nav id="menu">
      <div id="m0" class="menu-item">TV</div>
      <div id="m1" class="menu-item">FILME</div>
      <div id="m2" class="menu-item">SERIEN</div>
      <div id="m3" class="menu-item">EINSTELLUNG</div>
    </nav>
  </header>

  <main>
    <div class="panel">
      <div id="tv-view">
        <div class="tv-root">
          <div class="col" style="width:420px">
            <div class="col-h"><span>Kategorien</span><span id="tv-cat-count"></span></div>
            <div id="tv-cat-list" class="list"></div>
          </div>
          <div class="col" style="width:620px">
            <div class="col-h"><span>Sender</span><span id="tv-chan-count"></span></div>
            <div id="tv-chan-list" class="list"></div>
          </div>
          <div class="col" style="flex:1">
            <div class="col-h"><span>Player</span><span>OK=Play • 0=Fav • Back=Menu</span></div>
            <div class="player">
              <div class="video-box"><video id="tv-video" autoplay></video></div>
              <div class="pinfo">
                <div class="pname" id="tv-now">-</div>
                <div class="phint" id="tv-msg">Profil wählen...</div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div id="vod-view">
        <div class="vod-root">
          <div class="vod-topbar"><div class="vod-title" id="vod-title">FILME</div><div class="vod-sub" id="vod-sub">Xtream Profil benötigt</div></div>
          <div class="vod-rows" id="vod-rows"></div>
          <div class="vod-player-wrap">
            <div class="vod-player"><video id="vod-video" autoplay></video></div>
            <div class="vod-info"><h3>INFO</h3><div class="big" id="vod-info-title">-</div><div class="small" id="vod-info-sub">-</div></div>
          </div>
        </div>
      </div>
      <div id="setup-view">
        <div class="tabs">
          <div id="t0" class="tab">HINTERGRUND</div>
          <div id="t1" class="tab">M3U PROFILE</div>
          <div id="t2" class="tab">XTREAM PROFILE</div>
          <div id="t3" class="tab">MAC ADRESSE</div>
        </div>
        <div class="content-col">
          <div class="content-header"><span id="content-title">HINTERGRUND</span><span id="content-hint">Nav: ←/→</span></div>
          <div id="content-body" class="content-body"></div>
        </div>
      </div>
    </div>
  </main>

<script>
  var GH_OWNER = "Artonstyle", GH_REPO = "IPTVBlack", GH_BG_DIR = "hintergrund";
  var area = "menu", menuIdx = 0, tabIdx = 0, setupFocusIdx = 0, bgItems = [];
  var m3uProfiles = JSON.parse(localStorage.getItem("iptv_m3u_profiles") || "[]");
  var xcProfiles = JSON.parse(localStorage.getItem("iptv_xc_profiles") || "[]");
  var activeM3UId = localStorage.getItem("iptv_active_m3u_id") || "";
  var activeXCId = localStorage.getItem("iptv_active_xc_id") || "";
  var tvCats = [], tvAllChans = [], tvCurChans = [], tvCatIdx = 0, tvChanIdx = 0;
  var tvFavs = JSON.parse(localStorage.getItem("iptv_tv_favs") || "[]"), tvHls = null, tvFullscreen = false;
  var vodMode = "movies", vodRows = [], vodRowIdx = 0, vodItemIdx = 0, vodHls = null;

  function $(id){ return document.getElementById(id); }
  function esc(s){ return String(s||"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"); }
  function uuid(){ return "id_" + Date.now() + "_" + Math.floor(Math.random()*100000); }
  function clamp(v,min,max){ return Math.max(min, Math.min(max, v)); }

  // --- PLAYER ENGINE (H.265/HEVC OPTIMIERT FÜR 2026) ---
  function tvPlayCurrent(){
    if(!tvCurChans[tvChanIdx]) return;
    var chan = tvCurChans[tvChanIdx];
    $("tv-now").innerText = chan.name;
    $("tv-msg").innerText = "LIVE";
    var v=$("tv-video");
    if(tvHls){ try{ tvHls.stopLoad(); tvHls.detachMedia(); tvHls.destroy(); }catch(e){} tvHls=null; }
    try{ v.pause(); v.removeAttribute("src"); v.load(); }catch(e){}

    if(window.Hls && Hls.isSupported()){
      // H.265 Hardware-Beschleunigung & Speed-Parameter
      tvHls = new Hls({ 
        enableWorker: true, 
        lowLatencyMode: true, 
        backBufferLength: 60,
        maxBufferLength: 10,
        manifestLoadingMaxRetry: 10
      });
      tvHls.loadSource(chan.url);
      tvHls.attachMedia(v);
      tvHls.on(Hls.Events.MANIFEST_PARSED, function(){ v.play().catch(function(){ v.muted=true; v.play(); }); });
      tvHls.on(Hls.Events.ERROR, function(e,d){ if(d.fatal){ if(d.type==='networkError') tvHls.startLoad(); else tvHls.recoverMediaError(); }});
    }else{ v.src = chan.url; v.play().catch(function(){}); }
  }

  function vodPlayUrl(url){
    var v=$("vod-video");
    if(vodHls){ try{ vodHls.stopLoad(); vodHls.detachMedia(); vodHls.destroy(); }catch(e){} vodHls=null; }
    try{ v.pause(); v.removeAttribute("src"); v.load(); }catch(e){}
    if(window.Hls && Hls.isSupported()){
      vodHls = new Hls({ enableWorker:true, lowLatencyMode:true, backBufferLength:60 });
      vodHls.loadSource(url);
      vodHls.attachMedia(v);
      vodHls.on(Hls.Events.MANIFEST_PARSED, function(){ v.play().catch(function(){}); });
    }else{ v.src=url; v.play().catch(function(){}); }
  }

  // --- DER REST DEINES CODES (ÜBERNOMMEN AUS DEINER DATEI) ---
  function normalizeProfiles(){
    if(!Array.isArray(m3uProfiles)) m3uProfiles=[]; if(!Array.isArray(xcProfiles)) xcProfiles=[];
    localStorage.setItem("iptv_m3u_profiles", JSON.stringify(m3uProfiles)); localStorage.setItem("iptv_xc_profiles", JSON.stringify(xcProfiles));
  }
  function showMain(which){ $("tv-view").style.display=(which==="tv")?"block":"none"; $("vod-view").style.display=(which==="vod")?"block":"none"; $("setup-view").style.display=(which==="setup")?"flex":"none"; }
  function showMainByMenu(idx){ if(idx===0) showMain("tv"); else if(idx===1){ showMain("vod"); vodMode="movies"; $("vod-title").innerText="FILME"; } else if(idx===2){ showMain("vod"); vodMode="series"; $("vod-title").innerText="SERIEN"; } else showMain("setup"); }
  function loadBackgroundsFromGitHub(){
    fetch("https://api.github.com/repos/"+GH_OWNER+"/"+GH_REPO+"/contents/"+GH_BG_DIR).then(r=>r.json()).then(arr=>{
      bgItems = arr.filter(it=>it.type==="file" && /\.(jpg|jpeg|png|webp)$/i.test(it.name)).map(it=>({name:it.name, url:it.download_url}));
      if(menuIdx===3) renderSetupTabPreview();
    }).catch(()=>{});
  }
  function setBackground(url){ if(!url){ document.body.style.backgroundImage=""; document.body.style.background="radial-gradient(circle at top right, #001a4d, #00050a)"; return; } document.body.style.backgroundImage="linear-gradient(rgba(0,0,0,.45),rgba(0,0,0,.55)),url('"+url+"')"; document.body.style.backgroundSize="cover"; }
  function renderSetupTabPreview(){ if(tabIdx===0) renderBGTab(); else if(tabIdx===1) renderM3UTab(); else if(tabIdx===2) renderXCTab(); else renderMACTab(); updateFocus(); }
  function renderBGTab(){ var h=$("content-body"), html='<div class="tile-wrap">'; bgItems.forEach((b,i)=>{ html+='<div class="tile focusable" data-kind="bg" data-idx="'+i+'"><img src="'+b.url+'"><div class="label">'+esc(b.name)+'</div></div>'; }); h.innerHTML=html+'</div>'; }
  function renderMACTab(){ $("content-body").innerHTML='<div class="card2 focusable" data-kind="mac"><h3>MAC ADRESSE</h3><h2>'+(window.webapis?webapis.network.getMac():"unbekannt")+'</h2></div>'; }
  function renderM3UTab(){
    var h=$("content-body"), html='<div class="card2"><h3>M3U Profil</h3><input id="m3u-name" class="input focusable" placeholder="Name"><input id="m3u-url" class="input focusable" placeholder="URL"><div class="btn focusable" id="m3u-save" data-kind="m3u-save">Speichern</div></div>';
    m3uProfiles.forEach((p,i)=>{ html+='<div class="card2 focusable '+(p.id===activeM3UId?'focused':'')+'" data-kind="m3u-prof" data-idx="'+i+'"><h4>'+esc(p.name)+'</h4><small>'+esc(p.url)+'</small></div>'; }); h.innerHTML=html;
  }
  function renderXCTab(){
    var h=$("content-body"), html='<div class="card2"><h3>Xtream Profil</h3><input id="xc-name" class="input focusable" placeholder="Name"><input id="xc-user" class="input focusable" placeholder="User"><input id="xc-pass" class="input focusable" placeholder="Pass"><input id="xc-url" class="input focusable" placeholder="Server URL"><div class="btn focusable" id="xc-save" data-kind="xc-save">Speichern</div></div>';
    xcProfiles.forEach((p,i)=>{ html+='<div class="card2 focusable '+(p.id===activeXCId?'focused':'')+'" data-kind="xc-prof" data-idx="'+i+'"><h4>'+esc(p.name)+'</h4><small>'+esc(p.url)+'</small></div>'; }); h.innerHTML=html;
  }
  function tvReloadFromActiveProfile(){ var p=m3uProfiles.find(x=>x.id===activeM3UId); if(p) loadM3U(p.url); }
  function loadM3U(url){ fetch(url).then(r=>r.text()).then(t=>{ parseM3U(t); buildTVCategories(); filterTVCategory("ALL"); }).catch(()=>{}); }
  function parseM3U(t){ tvAllChans=[]; var lines=t.split("\n"), p=null; lines.forEach(l=>{ l=l.trim(); if(l.indexOf("#EXTINF")===0){ var n=l.split(",").pop(), g=l.match(/group-title="([^"]*)"/i); p={name:n,group:g?g[1]:"Allgemein"}; } else if(p && l.indexOf("http")===0){ tvAllChans.push({name:p.name,group:p.group,url:l}); p=null; }}); }
  function buildTVCategories(){ var counts={}; tvAllChans.forEach(c=>{ counts[c.group]=(counts[c.group]||0)+1; }); var g=Object.keys(counts).sort(); tvCats=[{key:"ALL",label:"ALL ("+tvAllChans.length+")"},{key:"Fav",label:"Favoriten ("+tvFavs.length+")"}]; g.forEach(x=>tvCats.push({key:x,label:x+" ("+counts[x]+")"})); }
  function filterTVCategory(k){ if(k==="ALL") tvCurChans=tvAllChans.slice(); else if(k==="Fav") tvCurChans=tvAllChans.filter(c=>tvFavs.indexOf(c.url)>-1); else tvCurChans=tvAllChans.filter(c=>c.group===k); tvChanIdx=0; renderTVLists(); }
  function renderTVLists(){ var c=""; tvCats.forEach((x,i)=>{ c+='<div class="entry tv-cat" data-idx="'+i+'">'+esc(x.label)+'</div>'; }); $("tv-cat-list").innerHTML=c; var h=""; tvCurChans.forEach((x,i)=>{ h+='<div class="entry tv-chan '+(tvFavs.indexOf(x.url)>-1?'is-fav':'')+'" data-idx="'+i+'"><span class="chan-num">'+(i+1)+'</span><span style="flex:1">'+esc(x.name)+'</span><span class="star">★</span></div>'; }); $("tv-chan-list").innerHTML=h; updateFocus(); }
  function tvToggleFav(){ if(!tvCurChans[tvChanIdx]) return; var u=tvCurChans[tvChanIdx].url, ix=tvFavs.indexOf(u); if(ix>-1) tvFavs.splice(ix,1); else tvFavs.push(u); localStorage.setItem("iptv_tv_favs",JSON.stringify(tvFavs)); buildTVCategories(); filterTVCategory(tvCats[tvCatIdx].key); }
  function tvToggleFullscreen(){ tvFullscreen=!tvFullscreen; document.body.classList.toggle("is-fullscreen", tvFullscreen); }

  function vodReloadFromActiveProfile(){
    var xc=xcProfiles.find(x=>x.id===activeXCId); if(!xc) return;
    fetch(xc.url+"/player_api.php?username="+xc.user+"&password="+xc.pass+"&action=get_vod_categories").then(r=>r.json()).then(cats=>{
      var chain=Promise.resolve([]);
      cats.slice(0,10).forEach(cat=>{ chain=chain.then(acc=>{ return fetch(xc.url+"/player_api.php?username="+xc.user+"&password="+xc.pass+"&action=get_vod_streams&category_id="+cat.category_id).then(r=>r.json()).then(items=>{ acc.push({title:cat.category_name, items:items.slice(0,15)}); return acc; }); }); });
      chain.then(rows=>{ vodRows=rows; renderVODRows(); });
    });
  }
  function renderVODRows(){
    var h=""; vodRows.forEach((r,ri)=>{ h+='<div class="row"><div class="row-h">'+esc(r.title)+'</div><div class="strip"><div class="strip-inner" id="strip-'+ri+'">'; r.items.forEach((it,ii)=>{ h+='<div class="card vod-card" data-row="'+ri+'" data-idx="'+ii+'"><img src="'+it.stream_icon+'"><div class="cap">'+esc(it.name)+'</div></div>'; }); h+='</div></div></div>'; });
    $("vod-rows").innerHTML=h; vodUpdateFocusAndScroll();
  }
  function vodUpdateFocusAndScroll(){
    document.querySelectorAll(".vod-card").forEach(c=>c.classList.remove("focused"));
    var el=document.querySelector('.vod-card[data-row="'+vodRowIdx+'"][data-idx="'+vodItemIdx+'"]');
    if(el){ el.classList.add("focused"); el.scrollIntoView({block:"center"}); }
    var s=$("strip-"+vodRowIdx); if(s) s.style.transform="translateX("+(-vodItemIdx*274)+"px)";
    var it=vodRows[vodRowIdx]?.items[vodItemIdx]; if(it){ $("vod-info-title").innerText=it.name; $("vod-info-sub").innerText="ID: "+it.stream_id; }
  }

  function updateFocus(){
    document.querySelectorAll(".menu-item").forEach((m,i)=>m.classList.toggle("focused", area==="menu" && i===menuIdx));
    if(area==="tvCats") document.querySelectorAll(".tv-cat").forEach((c,i)=>c.classList.toggle("focused", i===tvCatIdx));
    if(area==="tvChans") document.querySelectorAll(".tv-chan").forEach((c,i)=>c.classList.toggle("focused", i===tvChanIdx));
    if(area==="tabs") document.querySelectorAll(".tab").forEach((t,i)=>t.classList.toggle("focused", i===tabIdx));
    if(area==="setupContent") document.querySelectorAll(".focusable").forEach((f,i)=>f.classList.toggle("focused", i===setupFocusIdx));
  }

  document.addEventListener("keydown", function(e){
    var k=e.keyCode;
    if(k===10009 || k===27){ if(tvFullscreen){ tvToggleFullscreen(); return; } if(area!=="menu"){ area="menu"; updateFocus(); return; } tizen.application.getCurrentApplication().exit(); }
    if(area==="menu"){
      if(k===37) { menuIdx=(menuIdx>0)?menuIdx-1:3; showMainByMenu(menuIdx); }
      if(k===39) { menuIdx=(menuIdx<3)?menuIdx+1:0; showMainByMenu(menuIdx); }
      if(k===13 || k===40) { if(menuIdx===0) area="tvCats"; else if(menuIdx===3) area="tabs"; else area="vod"; updateFocus(); }
    } else if(area==="tvCats"){
      if(k===38) tvCatIdx=Math.max(0, tvCatIdx-1); if(k===40) tvCatIdx=Math.min(tvCats.length-1, tvCatIdx+1);
      if(k===13 || k===39) { area="tvChans"; filterTVCategory(tvCats[tvCatIdx].key); }
    } else if(area==="tvChans"){
      if(k===38) { tvChanIdx=Math.max(0, tvChanIdx-1); tvPlayCurrent(); } if(k===40) { tvChanIdx=Math.min(tvCurChans.length-1, tvChanIdx+1); tvPlayCurrent(); }
      if(k===48) tvToggleFav(); if(k===13) tvToggleFullscreen();
    } else if(area==="vod"){
      if(k===38 && vodRowIdx>0) { vodRowIdx--; vodItemIdx=0; } if(k===40 && vodRowIdx<vodRows.length-1) { vodRowIdx++; vodItemIdx=0; }
      if(k===37 && vodItemIdx>0) vodItemIdx--; if(k===39 && vodItemIdx<vodRows[vodRowIdx].items.length-1) vodItemIdx++;
      if(k===13) { var it=vodRows[vodRowIdx].items[vodItemIdx]; var xc=xcProfiles.find(x=>x.id===activeXCId); vodPlayUrl(xc.url+"/movie/"+xc.user+"/"+xc.pass+"/"+it.stream_id+".mp4"); }
      vodUpdateFocusAndScroll();
    } else if(area==="tabs"){
      if(k===37) { tabIdx=(tabIdx>0)?tabIdx-1:3; renderSetupTabPreview(); } if(k===39) { tabIdx=(tabIdx<3)?tabIdx+1:0; renderSetupTabPreview(); }
      if(k===13 || k===40) { area="setupContent"; setupFocusIdx=0; updateFocus(); }
    } else if(area==="setupContent"){
      var fs=document.querySelectorAll(".focusable");
      if(k===38 && setupFocusIdx>0) setupFocusIdx--; if(k===40 && setupFocusIdx<fs.length-1) setupFocusIdx++;
      if(k===13){
        var el=fs[setupFocusIdx], kind=el.getAttribute("data-kind");
        if(kind==="bg") setBackground(bgItems[el.getAttribute("data-idx")].url);
        if(kind==="m3u-save"){ var p={id:uuid(),name:$("m3u-name").value,url:$("m3u-url").value}; m3uProfiles.push(p); localStorage.setItem("iptv_m3u_profiles", JSON.stringify(m3uProfiles)); activeM3UId=p.id; localStorage.setItem("iptv_active_m3u_id",p.id); renderM3UTab(); tvReloadFromActiveProfile(); }
        if(kind==="m3u-prof"){ activeM3UId=m3uProfiles[el.getAttribute("data-idx")].id; localStorage.setItem("iptv_active_m3u_id",activeM3UId); renderM3UTab(); tvReloadFromActiveProfile(); }
        if(kind==="xc-save"){ var xp={id:uuid(),name:$("xc-name").value,user:$("xc-user").value,pass:$("xc-pass").value,url:$("xc-url").value}; xcProfiles.push(xp); localStorage.setItem("iptv_xc_profiles", JSON.stringify(xcProfiles)); activeXCId=xp.id; localStorage.setItem("iptv_active_xc_id",xp.id); renderXCTab(); vodReloadFromActiveProfile(); }
        if(kind==="xc-prof"){ activeXCId=xcProfiles[el.getAttribute("data-idx")].id; localStorage.setItem("iptv_active_xc_id",activeXCId); renderXCTab(); vodReloadFromActiveProfile(); }
      }
    }
    updateFocus();
  });

  function init(){
    try{ ["Up","Down","Left","Right","Enter","Back","0"].forEach(k=>tizen.tvinputdevice.registerKey(k)); }catch(e){}
    normalizeProfiles(); showMainByMenu(0); loadBackgroundsFromGitHub(); tvReloadFromActiveProfile(); vodReloadFromActiveProfile();
  }
</script>
</body>
</html>
