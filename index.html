<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Black IPTV 2026 - Player Edition</title>
  <script type="text/javascript" src="$WEBAPIS/webapis/webapis.js"></script>
  <style>
    :root { --blue: #0045ff; --cyan: #00d2ff; --bg: radial-gradient(circle at top right, #001a4d, #00050a); }
    * { box-sizing: border-box; outline: none; }
    body {
      width: 1920px; height: 1080px; margin: 0; background: var(--bg);
      color: white; font-family: Arial, sans-serif; overflow: hidden;
    }
    header { height: 160px; display: flex; justify-content: space-between; align-items: center; padding: 0 80px; border-bottom: 2px solid rgba(0,210,255,0.2); }
    #menu { display: flex; gap: 20px; }
    .item { padding: 20px 40px; font-size: 35px; font-weight: bold; color: rgba(255,255,255,.45); border-radius: 15px; }
    .item.focused { color: white; background: var(--blue); box-shadow: 0 0 30px var(--blue); transform: scale(1.05); }

    main { display: flex; height: 920px; padding: 40px; gap: 30px; }
    
    /* TV Ansicht */
    #tv-view { display: flex; width: 100%; gap: 30px; }
    #chan-list { width: 500px; background: rgba(0,0,0,0.5); border-radius: 20px; overflow-y: auto; padding: 10px; border: 1px solid #333; }
    .chan-item { padding: 20px; font-size: 24px; border-bottom: 1px solid #222; color: #aaa; border-radius: 10px; margin-bottom: 5px; }
    .chan-item.focused { background: var(--blue); color: white; }
    #video-container { flex: 1; background: #000; border-radius: 20px; border: 2px solid var(--cyan); position: relative; overflow: hidden; }
    
    /* Setup Ansicht */
    #setup-view { display: none; width: 100%; gap: 30px; }
    .column { background: rgba(0,0,0,0.6); border: 2px solid rgba(0,210,255,0.6); border-radius: 30px; flex: 1; padding: 30px; display: flex; flex-direction: column; align-items: center; }
    .btn { width: 90%; padding: 20px; margin: 10px 0; background: rgba(255,255,255,0.08); border: 3px solid transparent; border-radius: 15px; text-align: center; font-size: 24px; color: white; }
    .btn.focused { border-color: white; background: rgba(0,69,255,.6); }
    input { width: 90%; padding: 20px; margin: 10px 0; background: #222; border: 1px solid var(--cyan); color: white; font-size: 20px; border-radius: 10px; }
    .status { color: var(--cyan); margin-top: 10px; }
  </style>
</head>

<body onload="init()">
  <header>
    <div style="font-size: 50px; font-weight: bold;">BLACK<span style="color:var(--cyan)">IPTV</span></div>
    <nav id="menu">
      <div id="i0" class="item">TV</div>
      <div id="i1" class="item">FILME</div>
      <div id="i2" class="item">SERIEN</div>
      <div id="i3" class="item">EINSTELLUNG</div>
    </nav>
  </header>

  <main>
    <div id="tv-view">
      <div id="chan-list">
        <div class="chan-item">Keine Sender geladen</div>
      </div>
      <div id="video-container">
        <div id="player-msg" style="position:absolute; top:45%; width:100%; text-align:center; font-size:30px;">Wähle einen Sender</div>
      </div>
    </div>

    <div id="setup-view">
      <div class="column">
        <h2 style="color:var(--cyan)">DESIGN</h2>
        <div id="b1" class="btn">Galatasaray</div>
        <div id="b2" class="btn">Blue Neon</div>
        <div id="b3" class="btn">Standard</div>
        <div id="mac" class="status">MAC: Lade...</div>
      </div>
      <div class="column">
        <h2 style="color:var(--cyan)">SYNC</h2>
        <div id="b4" class="btn">VOM HANDY LADEN</div>
        <input id="url-display" type="text" placeholder="URL erscheint hier" readonly>
        <div id="status" class="status"></div>
      </div>
    </div>
  </main>

<script>
  var area = "menu", mIdx = 0, sIdx = 1, cIdx = 0;
  var channels = [];

  function $(id){ return document.getElementById(id); }

  function update(){
    var all = document.querySelectorAll(".item, .btn, .chan-item");
    all.forEach(el => el.classList.remove("focused"));

    $("tv-view").style.display = (mIdx === 0) ? "flex" : "none";
    $("setup-view").style.display = (mIdx === 3) ? "flex" : "none";

    if(area === "menu"){
      $("i"+mIdx).classList.add("focused");
    } else if(area === "setup"){
      $("b"+sIdx).classList.add("focused");
    } else if(area === "chan"){
      var items = document.querySelectorAll(".chan-item");
      if(items[cIdx]) items[cIdx].classList.add("focused");
    }
  }

  // M3U PARSER
  function parseM3U(data){
    channels = [];
    var lines = data.split("\n");
    var currentName = "";
    for(var i=0; i<lines.length; i++){
      var line = lines[i].trim();
      if(line.indexOf("#EXTINF") === 0){
        currentName = line.split(",")[1] || "Unbekannter Sender";
      } else if(line.indexOf("http") === 0){
        channels.push({ name: currentName, url: line });
      }
    }
    renderChannels();
  }

  function renderChannels(){
    var html = "";
    if(channels.length === 0) html = '<div class="chan-item">Keine Sender</div>';
    for(var i=0; i<channels.length; i++){
      html += '<div class="chan-item" id="c'+i+'">' + channels[i].name + '</div>';
    }
    $("chan-list").innerHTML = html;
  }

  function play(idx){
    var ch = channels[idx];
    if(!ch) return;
    $("player-msg").innerText = "Lade: " + ch.name;
    // Tizen AVPlay Logik
    try {
      webapis.avplay.open(ch.url);
      var rect = $("video-container").getBoundingClientRect();
      webapis.avplay.setDisplayRect(rect.left, rect.top, rect.width, rect.height);
      webapis.avplay.prepare();
      webapis.avplay.play();
    } catch(e) { $("player-msg").innerText = "Player Fehler"; }
  }

  function loadHandy(){
    $("status").innerText = "Lade...";
    var url = "https://raw.githubusercontent.com/Artonstyle/IPTVBlack/main/playlist.txt?t=" + Date.now();
    fetch(url).then(r => r.text()).then(txt => {
      $("url-display").value = txt.trim();
      $("status").innerText = "Geladen ✓";
      parseM3U(txt);
    });
  }

  document.addEventListener("keydown", function(e){
    var k = e.keyCode;
    if(k === 10009 || k === 27){ // BACK
       if(area !== "menu") { area = "menu"; update(); }
       else { try{tizen.application.getCurrentApplication().exit();}catch(ex){} }
       return;
    }

    if(area === "menu"){
      if(k === 37) mIdx = (mIdx > 0) ? mIdx - 1 : 3;
      if(k === 39) mIdx = (mIdx < 3) ? mIdx + 1 : 0;
      if(k === 40) { 
        if(mIdx === 0 && channels.length > 0) area = "chan";
        if(mIdx === 3) { area = "setup"; sIdx = 1; }
      }
    } else if(area === "chan"){
      if(k === 38) { if(cIdx > 0) cIdx--; else area = "menu"; }
      if(k === 40) { if(cIdx < channels.length - 1) cIdx++; }
      if(k === 13) play(cIdx);
    } else if(area === "setup"){
      if(k === 38) { if(sIdx > 1) sIdx--; else area = "menu"; }
      if(k === 40) { if(sIdx < 4) sIdx++; }
      if(k === 13) { if(sIdx === 4) loadHandy(); }
    }
    update();
  });

  function init(){
    try{ tizen.tvinputdevice.registerKey("Back"); }catch(e){}
    update();
  }
</script>
</body>
</html>
