<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Black IPTV 2026 – Tabs Setup</title>
  <script type="text/javascript" src="$WEBAPIS/webapis/webapis.js"></script>

  <style>
    :root{
      --blue:#0045ff;
      --cyan:#00d2ff;
      --glass2:rgba(0,40,120,.25);
      --muted:rgba(255,255,255,.65);
      --danger:#ff4d4d;
    }
    *{box-sizing:border-box; outline:none}
    body{
      width:1920px;height:1080px;margin:0;
      background: radial-gradient(circle at top right, #001a4d, #00050a);
      background-size:cover;background-position:center;
      color:#fff;font-family: Arial, sans-serif; overflow:hidden;
    }

    header{
      height:160px;
      display:flex; justify-content:space-between; align-items:center;
      padding:0 80px;
      border-bottom:2px solid rgba(0,210,255,.15);
    }
    .brand{font-size:52px; font-weight:900; letter-spacing:-1px}
    .brand span{color:var(--cyan); font-style:italic}
    #menu{display:flex; gap:18px}
    .menu-item{
      padding:18px 46px;
      font-size:34px;
      font-weight:900;
      color:rgba(255,255,255,.35);
      border-radius:16px;
      transition:.15s;
    }
    .menu-item.focused{
      background:var(--blue);
      color:#fff;
      box-shadow:0 0 30px rgba(0,69,255,.6);
      transform:scale(1.04);
    }

    main{height:920px; padding:40px 60px}

    .panel{
      height:100%;
      border-radius:32px;
      background: var(--glass2);
      border:1px solid rgba(0,210,255,.18);
      backdrop-filter: blur(10px);
      overflow:hidden;
      display:flex;
      flex-direction:column;
    }

    #tv-view, #vod-view, #setup-view { height:100%; display:none; }
    #tv-view{ display:flex; align-items:center; justify-content:center; font-size:48px; color:rgba(255,255,255,.85); }
    #vod-view{ display:flex; align-items:center; justify-content:center; font-size:48px; color:rgba(255,255,255,.85); }

    /* SETUP LAYOUT */
    #setup-view{ display:flex; flex-direction:column; gap:22px; padding:22px; }

    .tabs{
      display:flex; gap:14px;
      padding:10px;
      border-radius:22px;
      background: rgba(0,0,0,.25);
      border:1px solid rgba(0,210,255,.16);
    }
    .tab{
      padding:14px 24px;
      font-size:22px;
      font-weight:900;
      color:rgba(255,255,255,.45);
      border-radius:16px;
      transition:.12s;
      background: rgba(0,0,0,.15);
      border:1px solid rgba(0,210,255,.10);
    }
    .tab.focused{
      color:#fff;
      background: var(--blue);
      border-color: rgba(255,255,255,.15);
      box-shadow:0 0 18px rgba(0,69,255,.35);
      transform:scale(1.02);
    }

    /* Single content column (INFO/ACTION removed) */
    .content-col{
      flex:1;
      background: rgba(0,0,0,.22);
      border:1px solid rgba(0,210,255,.14);
      border-radius:26px;
      overflow:hidden;
      display:flex;
      flex-direction:column;
    }
    .content-header{
      padding:18px 20px;
      color:var(--cyan);
      font-weight:900;
      letter-spacing:3px;
      font-size:14px;
      text-transform:uppercase;
      border-bottom:1px solid rgba(0,210,255,.10);
    }
    .content-body{
      flex:1;
      overflow-y:auto;
      padding:16px;
    }
    .content-body::-webkit-scrollbar{ width:0; }

    /* Cards */
    .card{
      border-radius:18px;
      border:1px solid rgba(0,210,255,.14);
      background: rgba(0,0,0,.22);
      padding:16px;
      margin-bottom:14px;
      transition:.12s;
      color:rgba(255,255,255,.90);
    }
    .card.focused{
      border-color: rgba(0,210,255,.65);
      box-shadow:0 0 22px rgba(0,210,255,.12);
      transform: scale(1.01);
      background: rgba(0,69,255,.18);
    }
    .card-title{ font-weight:900; font-size:26px; }
    .card-sub{ margin-top:8px; color:rgba(255,255,255,.60); font-size:20px; word-break:break-all; }
    .badge{
      display:inline-block;
      padding:6px 10px;
      border-radius:999px;
      background: rgba(0,210,255,.12);
      border:1px solid rgba(0,210,255,.22);
      color: rgba(255,255,255,.85);
      font-weight:900;
      font-size:16px;
      margin-left:10px;
    }
    .danger{ color: var(--danger); font-weight:900; }

    /* Bigger profile text for TV (M3U/XC) */
    .profile .card-title{ font-size:32px; }
    .profile .card-sub{ font-size:24px; }

    /* Background grid: 6 columns smaller */
    .grid{
      display:grid;
      grid-template-columns: repeat(6, 1fr);
      gap:12px;
    }
    .gitem{
      height:120px;                 /* smaller */
      border-radius:16px;
      border:1px solid rgba(0,210,255,.14);
      background: rgba(0,0,0,.22);
      overflow:hidden;
      position:relative;
      transition:.12s;
    }
    .gitem.focused{
      border-color: rgba(0,210,255,.70);
      box-shadow:0 0 18px rgba(0,210,255,.10);
      transform: scale(1.03);
    }
    .gthumb{
      width:100%; height:100%;
      object-fit:cover;
      opacity:.92;
      display:block;
    }
    .glabel{
      position:absolute; left:0; right:0; bottom:0;
      padding:8px 8px;
      font-size:12px;
      font-weight:900;
      background: linear-gradient(to top, rgba(0,0,0,.85), rgba(0,0,0,0));
      text-shadow:0 2px 8px rgba(0,0,0,.6);
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }

    /* Form items inside same column */
    .label{ color:var(--cyan); font-weight:900; letter-spacing:2px; font-size:14px; margin-top:6px; }
    .input{
      width:100%;
      padding:18px 16px;
      margin-top:10px;
      border-radius:14px;
      border:1px solid rgba(0,210,255,.22);
      background: rgba(0,0,0,.28);
      color:#fff;
      font-size:22px;               /* bigger for TV */
    }
    .btnrow{ display:flex; gap:12px; margin-top:14px; }
    .btn{
      flex:1;
      padding:16px 14px;
      text-align:center;
      border-radius:14px;
      border:1px solid rgba(0,210,255,.22);
      background: rgba(0,69,255,.20);
      font-weight:900;
      font-size:20px;               /* bigger */
      transition:.12s;
    }
    .btn.focused{
      background: var(--blue);
      box-shadow:0 0 18px rgba(0,69,255,.35);
      transform:scale(1.02);
    }

    .divider{
      height:1px;
      background: rgba(0,210,255,.18);
      margin:16px 0;
    }
    .hint{
      margin-top:12px;
      color:rgba(255,255,255,.58);
      font-size:18px;
      line-height:1.35;
    }
  </style>
</head>

<body onload="init()">
  <header>
    <div class="brand">BLACK<span>IPTV</span></div>
    <nav id="menu">
      <div id="m0" class="menu-item">TV</div>
      <div id="m1" class="menu-item">FILME</div>
      <div id="m2" class="menu-item">SERIEN</div>
      <div id="m3" class="menu-item">EINSTELLUNG</div>
    </nav>
  </header>

  <main>
    <div class="panel">
      <div id="tv-view">Willkommen (TV)</div>
      <div id="vod-view">Willkommen (Filme/Serien Demo)</div>

      <div id="setup-view">
        <div class="tabs">
          <div id="t0" class="tab">HINTERGRUND</div>
          <div id="t1" class="tab">M3U PROFILE</div>
          <div id="t2" class="tab">XTREAM PROFILE</div>
          <div id="t3" class="tab">MAC ADRESSE</div>
        </div>

        <div class="content-col">
          <div id="content-title" class="content-header">HINTERGRUND</div>
          <div id="content-body" class="content-body"></div>
        </div>
      </div>
    </div>
  </main>

<script>
  // ===========================
  // KONFIG (DEIN GITHUB REPO)
  // ===========================
  var GH_OWNER = "Artonstyle";
  var GH_REPO  = "IPTVBlack";
  var GH_BG_DIR = "hintergrund";

  // ===========================
  // STATE
  // ===========================
  var area = "menu";   // menu | tabs | content
  var menuIdx = 3;

  var tabIdx = 0;      // 0=BG 1=M3U 2=XC 3=MAC
  var focusIdx = 0;

  // Background items
  var bgItems = []; // {name, raw}

  // Profiles Storage
  var m3uProfiles = JSON.parse(localStorage.getItem("iptv_m3u_profiles") || "[]");
  var xcProfiles  = JSON.parse(localStorage.getItem("iptv_xc_profiles")  || "[]");
  var activeM3U   = localStorage.getItem("iptv_active_m3u") || "";
  var activeXC    = localStorage.getItem("iptv_active_xc")  || "";

  function $(id){ return document.getElementById(id); }
  function esc(s){
    return String(s||"")
      .replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;");
  }
  function nowBust(){ return "t=" + Date.now(); }
  function clamp(v,min,max){ return Math.max(min, Math.min(max, v)); }

  // ===========================
  // INIT
  // ===========================
  function init(){
    try{
      ["Up","Down","Left","Right","Enter","Back","0","1","2","3","4","5","6","7","8","9"]
        .forEach(function(k){ tizen.tvinputdevice.registerKey(k); });
    }catch(e){}

    normalizeProfiles();

    showMain("setup");
    area = "menu";
    menuIdx = 3;

    renderMenu();
    renderTabs();

    // Tabs preview should show immediately on highlight
    renderTabPreview();

    // BG auto load
    loadBackgroundsFromGitHub();

    updateFocus();
  }

  function normalizeProfiles(){
    if(!Array.isArray(m3uProfiles)) m3uProfiles = [];
    if(!Array.isArray(xcProfiles))  xcProfiles  = [];

    for(var i=0;i<m3uProfiles.length;i++){
      if(!m3uProfiles[i].id) m3uProfiles[i].id = "m3u_" + Date.now() + "_" + i;
    }
    for(var j=0;j<xcProfiles.length;j++){
      if(!xcProfiles[j].id) xcProfiles[j].id = "xc_" + Date.now() + "_" + j;
    }

    localStorage.setItem("iptv_m3u_profiles", JSON.stringify(m3uProfiles));
    localStorage.setItem("iptv_xc_profiles", JSON.stringify(xcProfiles));
  }

  // ===========================
  // MAIN VIEW SWITCH
  // ===========================
  function showMain(which){
    $("tv-view").style.display = (which==="tv") ? "flex" : "none";
    $("vod-view").style.display = (which==="vod") ? "flex" : "none";
    $("setup-view").style.display = (which==="setup") ? "flex" : "none";
  }

  // ===========================
  // RENDER UI
  // ===========================
  function renderMenu(){
    for(var i=0;i<4;i++){
      $("m"+i).classList.toggle("focused", area==="menu" && i===menuIdx);
    }
  }

  function renderTabs(){
    for(var i=0;i<4;i++){
      $("t"+i).classList.toggle("focused", area==="tabs" && i===tabIdx);
    }
  }

  function setTabTitle(){
    var titles = ["HINTERGRUND","M3U PROFILE","XTREAM PROFILE","MAC ADRESSE"];
    $("content-title").innerText = titles[tabIdx];
  }

  // ✅ PREVIEW: shows immediately while switching tabs, no OK needed
  function renderTabPreview(){
    setTabTitle();
    focusIdx = 0;

    if(tabIdx===0) renderBGTab();
    else if(tabIdx===1) renderM3UTab();
    else if(tabIdx===2) renderXCTab();
    else renderMACTab();

    updateFocus();
  }

  // ===========================
  // BACKGROUND TAB
  // ===========================
  function renderBGTab(){
    var host = $("content-body");
    if(!bgItems.length){
      host.innerHTML =
        '<div class="card">'+
          '<div class="card-title">Lade Hintergründe…</div>'+
          '<div class="card-sub">GitHub: /'+esc(GH_BG_DIR)+'</div>'+
        '</div>';
      return;
    }

    var html = '<div class="grid">';
    for(var i=0;i<bgItems.length;i++){
      html +=
        '<div class="gitem focusable" data-kind="bg" data-idx="'+i+'">'+
          '<img class="gthumb" src="'+bgItems[i].raw+'?'+nowBust()+'"/>'+
          '<div class="glabel">'+esc(bgItems[i].name)+'</div>'+
        '</div>';
    }
    html += '</div>';

    html +=
      '<div class="divider"></div>'+
      '<div class="card">'+
        '<div class="card-title">Tipps</div>'+
        '<div class="card-sub">OK = Hintergrund setzen • 0 = Standard</div>'+
      '</div>';

    host.innerHTML = html;
  }

  function loadBackgroundsFromGitHub(){
    var url = "https://api.github.com/repos/"+encodeURIComponent(GH_OWNER)+"/"+encodeURIComponent(GH_REPO)+"/contents/"+encodeURIComponent(GH_BG_DIR)+"?"+nowBust();
    fetch(url)
      .then(function(r){ return r.json(); })
      .then(function(arr){
        if(!Array.isArray(arr)){ bgItems=[]; if(tabIdx===0) renderTabPreview(); return; }
        var list = [];
        for(var i=0;i<arr.length;i++){
          var it = arr[i];
          if(!it || it.type!=="file") continue;
          var n = (it.name||"").toLowerCase();
          if(!(n.endsWith(".jpg") || n.endsWith(".jpeg") || n.endsWith(".png") || n.endsWith(".webp"))) continue;
          var raw = "https://raw.githubusercontent.com/"+GH_OWNER+"/"+GH_REPO+"/main/"+GH_BG_DIR+"/"+it.name;
          list.push({ name: it.name, raw: raw });
        }
        list.sort(function(a,b){ return a.name.localeCompare(b.name); });
        bgItems = list;
        if(tabIdx===0) renderTabPreview();
      })
      .catch(function(){
        bgItems = [];
        if(tabIdx===0) renderTabPreview();
      });
  }

  function setBackground(rawUrl){
    if(!rawUrl){
      document.body.style.backgroundImage = "";
      document.body.style.background = "radial-gradient(circle at top right, #001a4d, #00050a)";
      return;
    }
    document.body.style.backgroundImage =
      "linear-gradient(rgba(0,0,0,.45), rgba(0,0,0,.55)), url('"+rawUrl+"?"+nowBust()+"')";
    document.body.style.backgroundSize = "cover";
    document.body.style.backgroundPosition = "center";
  }

  // ===========================
  // M3U TAB (Bigger text)
  // ===========================
  function renderM3UTab(){
    var host = $("content-body");
    var html = "";

    if(m3uProfiles.length){
      for(var i=0;i<m3uProfiles.length;i++){
        var p = m3uProfiles[i];
        var isActive = (p.url && p.url===activeM3U);
        html +=
          '<div class="card profile focusable" data-kind="m3uProfile" data-idx="'+i+'">'+
            '<div class="card-title">'+esc(p.name || ("Profil "+(i+1)))+(isActive?'<span class="badge">AKTIV</span>':'')+'</div>'+
            '<div class="card-sub">'+esc(p.url || "-")+'</div>'+
            '<div class="card-sub"><span class="danger">0</span> = Löschen • OK = Aktivieren</div>'+
          '</div>';
      }
    }else{
      html +=
        '<div class="card profile">'+
          '<div class="card-title">Keine M3U Profile</div>'+
          '<div class="card-sub">Unten Name + URL speichern.</div>'+
        '</div>';
    }

    html += '<div class="divider"></div>';

    html +=
      '<div class="card">'+
        '<div class="card-title">Neues M3U Profil</div>'+
        '<div class="label">PROFILNAME</div>'+
        '<input id="m3u-name" class="input focusable" data-kind="m3uInput" data-idx="0" placeholder="z.B. Mein Anbieter" />'+
        '<div class="label">M3U URL</div>'+
        '<input id="m3u-url" class="input focusable" data-kind="m3uInput" data-idx="1" placeholder="https://example.com/list.m3u" />'+
        '<div class="btnrow">'+
          '<div id="m3u-save" class="btn focusable" data-kind="m3uBtn" data-idx="0">SPEICHERN</div>'+
          '<div id="m3u-clear" class="btn focusable" data-kind="m3uBtn" data-idx="1">LEEREN</div>'+
        '</div>'+
        '<div class="hint">OK auf Eingabe = Tastatur • OK auf SPEICHERN = speichern</div>'+
      '</div>';

    host.innerHTML = html;

    try{ $("m3u-url").value = activeM3U || ""; }catch(e){}
  }

  function saveM3UProfile(){
    var name = ($("m3u-name").value || "").trim();
    var url  = ($("m3u-url").value  || "").trim();
    if(!url) return;

    if(!name) name = "M3U " + (m3uProfiles.length+1);

    var id = "m3u_" + Date.now();
    m3uProfiles.unshift({ id:id, name:name, url:url });
    if(m3uProfiles.length>30) m3uProfiles = m3uProfiles.slice(0,30);

    localStorage.setItem("iptv_m3u_profiles", JSON.stringify(m3uProfiles));
    localStorage.setItem("iptv_active_m3u", url);
    activeM3U = url;

    renderTabPreview();
  }

  function deleteM3UProfile(index){
    if(index<0 || index>=m3uProfiles.length) return;
    var wasActive = (m3uProfiles[index].url === activeM3U);

    m3uProfiles.splice(index,1);
    localStorage.setItem("iptv_m3u_profiles", JSON.stringify(m3uProfiles));

    if(wasActive){
      activeM3U = "";
      localStorage.setItem("iptv_active_m3u", "");
    }

    renderTabPreview();
  }

  function activateM3UProfile(index){
    if(index<0 || index>=m3uProfiles.length) return;
    activeM3U = m3uProfiles[index].url || "";
    localStorage.setItem("iptv_active_m3u", activeM3U);
    renderTabPreview();
  }

  // ===========================
  // XTREAM TAB (Bigger text)
  // ===========================
  function renderXCTab(){
    var host = $("content-body");
    var html = "";

    if(xcProfiles.length){
      for(var i=0;i<xcProfiles.length;i++){
        var p = xcProfiles[i];
        var isActive = (p.id === activeXC);
        html +=
          '<div class="card profile focusable" data-kind="xcProfile" data-idx="'+i+'">'+
            '<div class="card-title">'+esc(p.name || ("Xtream "+(i+1)))+(isActive?'<span class="badge">AKTIV</span>':'')+'</div>'+
            '<div class="card-sub">'+esc(p.url || "-")+'</div>'+
            '<div class="card-sub">User: '+esc(p.user || "-")+'</div>'+
            '<div class="card-sub"><span class="danger">0</span> = Löschen • OK = Aktivieren</div>'+
          '</div>';
      }
    }else{
      html +=
        '<div class="card profile">'+
          '<div class="card-title">Keine Xtream Profile</div>'+
          '<div class="card-sub">Unten ein Profil speichern.</div>'+
        '</div>';
    }

    html += '<div class="divider"></div>';

    html +=
      '<div class="card">'+
        '<div class="card-title">Neues Xtream Profil</div>'+
        '<div class="label">PROFILNAME</div>'+
        '<input id="xc-name" class="input focusable" data-kind="xcInput" data-idx="0" placeholder="z.B. Anbieter 1" />'+
        '<div class="label">SERVER URL</div>'+
        '<input id="xc-url" class="input focusable" data-kind="xcInput" data-idx="1" placeholder="http://server:port" />'+
        '<div class="label">BENUTZERNAME</div>'+
        '<input id="xc-user" class="input focusable" data-kind="xcInput" data-idx="2" placeholder="username" />'+
        '<div class="label">PASSWORT</div>'+
        '<input id="xc-pass" class="input focusable" data-kind="xcInput" data-idx="3" placeholder="password" />'+
        '<div class="btnrow">'+
          '<div id="xc-save" class="btn focusable" data-kind="xcBtn" data-idx="0">SPEICHERN</div>'+
          '<div id="xc-clear" class="btn focusable" data-kind="xcBtn" data-idx="1">LEEREN</div>'+
        '</div>'+
        '<div class="hint">OK auf Eingabe = Tastatur • OK auf SPEICHERN = speichern</div>'+
      '</div>';

    host.innerHTML = html;

    var ap = getActiveXCProfile();
    if(ap){
      try{
        $("xc-name").value = ap.name || "";
        $("xc-url").value  = ap.url  || "";
        $("xc-user").value = ap.user || "";
        $("xc-pass").value = ap.pass || "";
      }catch(e){}
    }
  }

  function saveXCProfile(){
    var name = ($("xc-name").value || "").trim();
    var url  = ($("xc-url").value  || "").trim();
    var user = ($("xc-user").value || "").trim();
    var pass = ($("xc-pass").value || "").trim();
    if(!url || !user) return;

    if(!name) name = "Xtream " + (xcProfiles.length+1);

    var id = "xc_" + Date.now();
    xcProfiles.unshift({ id:id, name:name, url:url, user:user, pass:pass });
    if(xcProfiles.length>30) xcProfiles = xcProfiles.slice(0,30);

    localStorage.setItem("iptv_xc_profiles", JSON.stringify(xcProfiles));
    localStorage.setItem("iptv_active_xc", id);
    activeXC = id;

    renderTabPreview();
  }

  function deleteXCProfile(index){
    if(index<0 || index>=xcProfiles.length) return;
    var wasActive = (xcProfiles[index].id === activeXC);

    xcProfiles.splice(index,1);
    localStorage.setItem("iptv_xc_profiles", JSON.stringify(xcProfiles));

    if(wasActive){
      activeXC = "";
      localStorage.setItem("iptv_active_xc", "");
    }

    renderTabPreview();
  }

  function activateXCProfile(index){
    if(index<0 || index>=xcProfiles.length) return;
    activeXC = xcProfiles[index].id;
    localStorage.setItem("iptv_active_xc", activeXC);
    renderTabPreview();
  }

  function getActiveXCProfile(){
    for(var i=0;i<xcProfiles.length;i++){
      if(xcProfiles[i].id === activeXC) return xcProfiles[i];
    }
    return null;
  }

  // ===========================
  // MAC TAB
  // ===========================
  function renderMACTab(){
    var mac = getMacAddressSafe();
    $("content-body").innerHTML =
      '<div class="card profile focusable" data-kind="mac" data-idx="0">'+
        '<div class="card-title">MAC ADRESSE</div>'+
        '<div class="card-sub" style="font-size:28px">'+esc(mac)+'</div>'+
        '<div class="card-sub">OK = aktualisieren</div>'+
      '</div>'+
      '<div class="hint">Hinweis: Manche Geräte geben die MAC nur über WebAPI zurück.</div>';
  }

  function getMacAddressSafe(){
    try{
      if(window.webapis && webapis.network && typeof webapis.network.getMac==="function"){
        var m = webapis.network.getMac();
        if(m) return m;
      }
    }catch(e){}
    return "unbekannt";
  }

  // ===========================
  // FOCUS HELPERS
  // ===========================
  function getFocusables(){
    var host = $("content-body");
    return host.querySelectorAll(".focusable, .gitem.focusable, .btn.focusable, .input.focusable, .card.focusable");
  }

  function updateFocus(){
    // menu focus
    for(var i=0;i<4;i++){
      $("m"+i).classList.toggle("focused", area==="menu" && i===menuIdx);
    }

    // tabs focus
    for(var t=0;t<4;t++){
      $("t"+t).classList.toggle("focused", area==="tabs" && t===tabIdx);
    }

    // content focus
    var f = getFocusables();
    for(var j=0;j<f.length;j++){
      f[j].classList.remove("focused");
    }

    if(area==="content"){
      if(f.length){
        focusIdx = clamp(focusIdx, 0, f.length-1);
        f[focusIdx].classList.add("focused");
        try{ f[focusIdx].scrollIntoView({block:"center"}); }catch(e){}
      }
    }
  }

  // ===========================
  // KEY HANDLING
  // ===========================
  document.addEventListener("keydown", function(e){
    var k = e.keyCode;

    // BACK
    if(k===10009 || k===27){
      var ae = document.activeElement;
      if(ae && ae.tagName==="INPUT"){
        try{ ae.blur(); }catch(ex){}
        return;
      }

      if(area==="content"){
        area = "tabs";
        updateFocus();
        return;
      }
      if(area==="tabs"){
        area = "menu";
        updateFocus();
        return;
      }
      try{ tizen.application.getCurrentApplication().exit(); }catch(ex){}
      return;
    }

    // MENU
    if(area==="menu"){
      if(k===37) menuIdx = (menuIdx>0) ? menuIdx-1 : 3;
      if(k===39) menuIdx = (menuIdx<3) ? menuIdx+1 : 0;

      if(k===13 || k===40){
        if(menuIdx===0){ showMain("tv"); }
        if(menuIdx===1){ showMain("vod"); $("vod-view").innerText="Filme (Demo)"; }
        if(menuIdx===2){ showMain("vod"); $("vod-view").innerText="Serien (Demo)"; }
        if(menuIdx===3){
          showMain("setup");
          area="tabs";
          renderTabs();
          renderTabPreview();
        }
      }
      updateFocus();
      return;
    }

    // TABS (✅ preview on switch; ✅ enter content only on OK)
    if(area==="tabs"){
      if(k===37) tabIdx = (tabIdx>0) ? tabIdx-1 : 3;
      if(k===39) tabIdx = (tabIdx<3) ? tabIdx+1 : 0;

      // show preview immediately without OK
      renderTabs();
      renderTabPreview();

      // OK enters content
      if(k===13 || k===40){
        area="content";
        focusIdx = 0;
        updateFocus();
      }
      return;
    }

    // CONTENT
    if(area==="content"){
      var focusables = getFocusables();
      var len = focusables.length;

      // 0 deletes selected profile OR sets default bg
      if(k===48){
        if(tabIdx===0){
          setBackground(null);
        }else{
          if(len){
            var el = focusables[focusIdx];
            var kind = el.getAttribute("data-kind") || "";
            var idx = parseInt(el.getAttribute("data-idx")||"-1",10);

            if(kind==="m3uProfile") deleteM3UProfile(idx);
            if(kind==="xcProfile") deleteXCProfile(idx);
          }
        }
        updateFocus();
        return;
      }

      // UP/DOWN
      if(k===38){
        if(focusIdx===0){
          area="tabs";
          updateFocus();
          return;
        }
        focusIdx = Math.max(0, focusIdx-1);
        updateFocus();
        return;
      }
      if(k===40){
        if(len) focusIdx = Math.min(len-1, focusIdx+1);
        updateFocus();
        return;
      }

      // LEFT/RIGHT for BG grid nicer movement (6 cols)
      if(tabIdx===0){
        var cols = 6;
        if(k===37){
          // left
          focusIdx = Math.max(0, focusIdx-1);
          updateFocus();
          return;
        }
        if(k===39){
          // right
          if(len) focusIdx = Math.min(len-1, focusIdx+1);
          updateFocus();
          return;
        }
        if(k===38){
          // already handled
        }
        if(k===40){
          // already handled
        }
      }

      // OK actions
      if(k===13 && len){
        var el2 = focusables[focusIdx];

        // input: focus keyboard
        if(el2.tagName==="INPUT"){
          try{ el2.focus(); }catch(e){}
          return;
        }

        var kind2 = el2.getAttribute("data-kind") || "";
        var idx2 = parseInt(el2.getAttribute("data-idx")||"-1",10);

        if(tabIdx===0 && kind2==="bg"){
          if(bgItems[idx2]) setBackground(bgItems[idx2].raw);
          return;
        }

        if(kind2==="m3uProfile") { activateM3UProfile(idx2); return; }
        if(el2.id==="m3u-save") { saveM3UProfile(); return; }
        if(el2.id==="m3u-clear"){
          try{
            $("m3u-name").value="";
            $("m3u-url").value=activeM3U||"";
          }catch(e){}
          updateFocus();
          return;
        }

        if(kind2==="xcProfile") { activateXCProfile(idx2); return; }
        if(el2.id==="xc-save") { saveXCProfile(); return; }
        if(el2.id==="xc-clear"){
          try{
            $("xc-name").value="";
            $("xc-url").value="";
            $("xc-user").value="";
            $("xc-pass").value="";
          }catch(e){}
          updateFocus();
          return;
        }

        if(kind2==="mac"){
          renderTabPreview();
          return;
        }
      }
    }
  });

  // Click support (emulator)
  document.addEventListener("click", function(ev){
    var id = (ev.target && ev.target.id) ? ev.target.id : "";
    if(id==="m3u-save") saveM3UProfile();
    if(id==="m3u-clear"){
      try{ $("m3u-name").value=""; $("m3u-url").value=activeM3U||""; }catch(e){}
      updateFocus();
    }
    if(id==="xc-save") saveXCProfile();
    if(id==="xc-clear"){
      try{ $("xc-name").value=""; $("xc-url").value=""; $("xc-user").value=""; $("xc-pass").value=""; }catch(e){}
      updateFocus();
    }
  });
</script>
</body>
</html>
